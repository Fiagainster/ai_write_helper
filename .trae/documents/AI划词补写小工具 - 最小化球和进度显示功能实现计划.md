# AI划词补写小工具 - 最小化球和进度显示功能实现计划

## 一、功能需求分析

1. **最小化功能**：用户可以按一个键将交互界面最小化为一个球或其他形状
2. **始终显示在最上层**：最小化后的球始终显示在屏幕最上层
3. **进度显示**：球的上部显示进度信息，文字停留一秒，醒目且大小适中
4. **不干扰用户浏览**：设计简洁，不影响用户正常操作
5. **点击展开**：用户可以点击球将界面展开
6. **可配置**：用户可以在界面中开启或关闭此功能

## 二、实现方案

### 1. 核心技术点

* **窗口状态管理**：实现正常窗口和最小化球之间的切换

* **系统托盘/悬浮窗口**：使用PyQt6的QSystemTrayIcon或自定义悬浮窗口实现

* **进度显示**：在悬浮窗口上显示进度文字

* **全局快捷键**：实现最小化/展开的快捷键

* **配置管理**：添加配置选项，允许用户开启/关闭此功能

### 2. 实现步骤

#### 步骤1：添加配置选项

* 在`config_manager.py`的默认配置中添加`show_minimize_ball`选项

* 默认值为`true`，允许用户在界面中修改

#### 步骤2：实现最小化球功能

* 创建一个自定义的悬浮窗口类`MinimizeBall`，继承自`QWidget`

* 设置窗口为无边框、半透明、始终置顶

* 实现圆形外观和进度文字显示

* 添加点击事件，点击时展开主窗口

<br />

#### 步骤3：在主窗口中集成

* 在`MainWindow`类中添加`MinimizeBall`实例

* 实现窗口最小化和展开的逻辑

* 连接进度信号，在球上显示进度信息

#### 步骤4：添加配置界面

* 在主窗口的设置界面中添加"显示最小化球"的复选框

* 允许用户开启或关闭此功能

#### 步骤5：实现进度显示

* 在`monitor.py`中添加进度信号

* 在球上显示进度文字，停留一秒后消失

* 使用醒目的颜色和字体，确保用户能注意到

### 3. 代码修改点

#### 文件1：`ai_write_helper/core/config_manager.py`

* 添加`show_minimize_ball`配置选项

#### 文件2：`ai_write_helper/ui/main_window.py`

* 添加`MinimizeBall`类

* 集成最小化球功能

* 添加配置复选框

#### 文件3：`ai_write_helper/services/monitor.py`

* 添加全局快捷键监听

* 添加进度信号

### 4. 设计细节

* **球的外观**：圆形，半透明，大小适中（约50x50像素）

* **进度显示**：文字居中显示在球的上部，使用醒目的颜色（如红色或绿色），字体大小适中

* **动画效果**：进度文字淡入淡出，停留一秒后自动消失

* **交互方式**：点击球展开窗口，快捷键切换状态

* **性能优化**：最小化时释放部分资源，确保不影响系统性能

### 5. 测试计划

* 测试最小化/展开功能是否正常工作

* 测试进度显示是否正确

* 测试快捷键是否响应

* 测试配置选项是否生效

* 测试在不同分辨率和系统下的表现

## 三、预期效果

1. 用户可以通过快捷键将界面最小化为一个球
2. 球始终显示在屏幕最上层，不干扰用户正常浏览
3. 球上显示醒目的进度信息，停留一秒后消失
4. 用户可以点击球将界面展开
5. 用户可以在界面中开启或关闭此功能
6. 整体设计简洁美观，不影响用户体验

## 四、技术栈

* PyQt6：用于实现UI和悬浮窗口

* 现有代码架构：基于现有代码进行扩展，不破坏原有功能

* 全局快捷键：使用pynput库实现

## 五、风险评估

* **系统兼容性**：不同操作系统对悬浮窗口的支持可能不同，需要测试

* **性能影响**：悬浮窗口可能会消耗一定资源，需要优化

* **用户体验**：需要确保设计简洁，不干扰用户正常操作

通过以上实现方案，我们可以为AI划词补写小工具添加一个实用的最小化球和进度显示功能，提高用户体验，让用户在使用过程中能够清楚地了解当前进度。
